<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Editor</title>
    <style type="text/css" media="screen">
        body {
            overflow: hidden;
        }

    #editor {
		z-index: 1;
        margin: 0;
        background-color: black;
        opacity: 1.5;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        transition-duration: 0.4s;
		background: rgba(0, 0, 0, 0.25)!important;
    }

    .ace_gutter {
        background: rgba(0, 0, 0, 0.30)!important
    }

    .ace_gutter-active-line {
      background-color: rgba(0, 0, 0, 0.10)!important;
    }

    .ace_active-line {
      background: rgba(0, 0, 0, 0.25)!important;
    }

    </style>
    <script src="ace/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="ace/ext-language_tools.js"></script>
</head>
<body style="background-color: #372546c">
    <pre id="editor"></pre>
    <script>
        var GetText;
        var SetText;
        var ClearText;
        var SetTheme;
        
        ace.require("ace/ext/language_tools");
        var editor = ace.edit("editor");

        editor.setOption("enableBasicAutocompletion", true);
        editor.setOption("enableLiveAutocompletion", true);
        editor.setOption("enableSnippets", true);
		
        editor.setTheme("ace/theme/tomorrow_night_eighties");
		
        editor.session.setMode("ace/mode/lua");
		
        editor.setOption("cursorStyle", "smooth");
        document.getElementById("editor").style.fontSize="14spx";

        editor.setShowPrintMargin(false);

        /* do not edit below - Synapse X internal code */
        GetText = function()
        {
            return editor.getValue();
        }
        
        SetText = function(x)
        {
            editor.setValue(x);
            editor.session.setValue(x);
			editor.renderer.scrollToX(0);  // Start by scrolling to the left
			editor.renderer.setScrollMargin(0, 0, 0, 0);  // Remove any scroll margins
			editor.setOption("scrollPastEnd", 0.5);  // Allow scrolling beyond the last line
			editor.resize();  
        }
        
        ClearText = function()
        {
            editor.setValue("");
        }
        
        SetTheme = function(th)
        {
            editor.setTheme("ace/theme/" + th);
        }
        
        editor.on("input", async function() 
        {
            await CefSharp.BindObjectAsync("synServiceAsync");
            synServiceAsync.textChanged(editor.getValue());
        });
		
		editor.commands.on('afterExec', function(e) {
            if (e.command.name === 'insertstring' && e.args === '{') {
                const session = editor.session;
                const position = editor.getCursorPosition();
				
                session.insert({ row: position.row, column: position.column }, '}');

                editor.moveCursorToPosition(position);
            }
        });
		
        document.addEventListener('keydown', async e => 
        {
            if (e.ctrlKey) 
            {
                if (e.key === 's')
                {
                    e.preventDefault();
                    
                    await CefSharp.BindObjectAsync("synServiceAsync");
                    
                    synServiceAsync.saveRequest();
                }
                else if (e.key === 'o')
                {
                    e.preventDefault();
                    
                    await CefSharp.BindObjectAsync("synServiceAsync");
                    
                    synServiceAsync.openRequest();
				}
                else if (e.key === '+' || e.key === '=')
                {
                    await CefSharp.BindObjectAsync("synServiceAsync");
                    
                    synServiceAsync.zoomRequest(true);
				}
                else if (e.key === '-' || e.key === '_')
                {
                    await CefSharp.BindObjectAsync("synServiceAsync");
                    
                    synServiceAsync.zoomRequest(false);
                }
				else if (e.key === '0' || e.key === ')')
                {
                    await CefSharp.BindObjectAsync("synServiceAsync");
                    
                    synServiceAsync.zoomResetRequest();
                }
            }
        });
        
        document.oncontextmenu = function()
        {
            return false;
        }

        var keywords = (
            "break|do|else|elseif|end|for|function|if|in|local|repeat|"+
            "return|then|until|while|or|and|not|continue"
        );

        var libraries = (
            "bit|crypt|debug|Drawing|syn|websocket|"+  // Synapse X Libraries
            "coroutine|debug|math|os|string|table|utf8|bit32"  // Roblox Libraries
        );

        var constants = (
            "true|false|nil|_G|_VERSION|game|"+
            "math.huge|math.pi|"+
            "utf8.charpattern"
        );

        var classes = (
            "SocialService|VRService|ContentProvider|LocalizationService|"+
            "PhysicsService|ServerScriptService|ReplicatedStorage|Lighting|"+
            "MessagingService|Workspace|ChangeHistoryService|MemoryStoreService|"+
            "MarketplaceService|ProximityPromptService|PolicyService|"+
            "DataStoreService|Teams|ReplicatedFirst|PathfindingService|"+
            "SoundService|StarterPack|BadgeService|Debris|RunService|"+
            "StarterGui|GuiService|StarterPlayer|ServerStorage|"+
            "ContextActionService|TeleportService|CollectionService|"+
            "HapticService|CoreGui"
        );
		
		var functionsWithoutArgs = [
			"getgenv", "getrenv", "getreg", "getgc", "getinstances", "getnilinstances", 
			"getscripts", "getloadedmodules", "iswindowactive", "checkcaller", "os.clock"
		];


		var functionsWithArgs = [
			"getconnections", "firesignal", "firetouchinterest", "fireproximityprompt", "fireclickdetector", 
			"isnetworkowner", "gethiddenproperty", "gethiddenproperties", "sethiddenproperty",
			"getsenv", "getcallingscript", "getscriptclosure", "getscripthash",
			"getrawmetatable", "setrawmetatable", "setreadonly", "isreadonly",
			"keypress", "keyrelease", "mouse1click", "mouse1press", "mouse1release", 
			"mouse2click", "mouse2press", "mouse2release", "mousescroll", "mousemoverel", "mousemoveabs",
			"hookfunction", "hookmetamethod", "newcclosure",
			"loadstring", "checkcaller", "islclosure", "dumpstring", "decompile",
			"rconsoleprint", "rconsoleinfo", "rconsolewarn", "rconsoleerr", "rconsoleclear", 
			"rconsolename", "rconsoleinput", "printconsole",
			"readfile", "writefile", "appendfile", "loadfile", "listfiles", "isfile", "isfolder", "makefolder", "delfolder", "delfile",
			"setclipboard", "setfflag", "getnamecallmethod", "setnamecallmethod", "getsynasset", "getspecialinfo", "saveinstance", "messagebox",
			"getinstancefromstate", "cloneref", "isrbxactive", "identifyexecutor", "is_redirection_enabled", "syn_isactive", "isreadonly", 
			"require", "getprops", "replaceclosure", "getscriptclosure", "setfpscap",
			"rconsoleinputasync", "messageboxasync", "readbinarystring", "setnamecallmethod", "setscriptable", 
			"setuntouched", "isuntouched", "getstateenv", "getpcdprop", "getstates", "dumpheap", "loadmodule", 
			"setmemorycategory", "profilebegin", "traceback", "resetmemorycategory", "profileend",
			"bit.bdiv", "bit.badd", "bit.bsub", "bit.bmul", "bit.band", "bit.bor", "bit.bxor", "bit.bnot", "bit.bswap", 
			"bit.ror", "bit.rol", "bit.tohex", "bit.tobit", "bit.lshift", "bit.rshift", "bit.arshift",
			"crypt.encrypt", "crypt.decrypt", "crypt.base64.encode", "crypt.base64.decode", "crypt.hash", 
			"crypt.derive", "crypt.random", "crypt.custom.encrypt", "crypt.custom.decrypt", "crypt.custom.hash",
			"debug.getconstants", "debug.getconstant", "debug.setconstant", "debug.getupvalues", "debug.getupvalue", 
			"debug.setupvalue", "debug.getprotos", "debug.getproto", "debug.getstack", "debug.setstack", 
			"debug.setmetatable", "debug.getregistry", "debug.getinfo",
			"Drawing.new",
			"cache_replace", "cache_invalidate", "set_thread_identity", "get_thread_identity", "is_cached", 
			"write_clipboard", "queue_on_teleport", "protect_gui", "unprotect_gui", "is_beta", "request", 
			"secure_call", "create_secure_function", "run_secure_function",
			"websocket.connect",
			"assert", "collectgarbage", "error", "getfenv", "getmetatable", "ipairs", "newproxy", 
			"next", "pairs", "pcall", "print", "rawequal", "rawget", "rawset", "select", "setfenv", "setmetatable", 
			"tonumber", "tostring", "type", "unpack", "xpcall",
			"coroutine.create", "coroutine.resume", "coroutine.yield", "coroutine.status", "coroutine.wrap", 
			"coroutine.running",
			"debug.traceback", "debug.info", "debug.profilebegin", "debug.profileend", 
			"debug.setmemorycategory", "debug.resetmemorycategory",
			"math.abs", "math.acos", "math.asin", "math.atan", "math.atan2", "math.ceil", 
			"math.clamp", "math.cos", "math.cosh", "math.deg", "math.exp", "math.floor", "math.fmod", 
			"math.frexp", "math.ldexp", "math.log", "math.log10", "math.max", "math.min", "math.modf", 
			"math.noise", "math.pow", "math.rad", "math.random", "math.randomseed", "math.round", 
			"math.sign", "math.sin", "math.sqrt", "math.tan",
			"os.time", "os.difftime", "os.date",
			"string.byte", "string.char", "string.find", "string.format", "string.gmatch", "string.gsub", 
			"string.len", "string.lower", "string.match", "string.rep", "string.reverse", "string.split", "string.sub", 
			"string.upper",
			"table.clear", "table.concat", "table.create", "table.find", "table.foreach", "table.foreachi", 
			"table.freeze", "table.getn", "table.insert", "table.insert", "table.isfrozen", "table.move", 
			"table.pack", "table.remove", "table.sort", "table.unpack",
			"utf8.char", "utf8.codes", "utf8.codepoint", "utf8.len", "utf8.offset", "utf8.graphemes", 
			"utf8.nfcnormalize", "utf8.nfdnormalize",
			"bit32.arshift", "bit32.band", "bit32.bnot", "bit32.bor", "bit32.btest", "bit32.bxor", 
			"bit32.extract", "bit32.lrotate", "bit32.lshift", "bit32.replace", "bit32.rrotate", 
			"bit32.rshift", "bit32.tobit"
		]
		
        // Define Custom Snippets
        var snippets = [
            {
                "name": "do .. end",
                "content": "do\n\t${1:}\nend",
            }, {
                "name": "elseif .. then",
                "content": "elseif ${1:} then ${2:}",
            }, {
                "name": "for .. ipairs",
                "content": "for ${1:index}, ${2:value} in ipairs(${3:t}) do\n\t${4:}\nend",
            }, {
                "name": "for .. pairs",
                "content": "for ${1:index}, ${2:value} in pairs(${3:t}) do\n\t${4:}\nend",
            },{
                "name": "for i = ...",
                "content": "for ${1:i} = ${2:1}, ${3:10} do\n\t${4:}\nend",
            }, {
                "name": "function ()",
                "content": "function ${1:}(${2:})\n\t${3:}\nend",
            }, {
                "name": "if .. then",
                "content": "if ${1:} then\n\t${2:}\nend",
            }, {
                "name": "in ..",
                "content": "in ${1:pairs(${2:t})} do\n\t${3:}\nend",
            }, {
                "name": "local function",
                "content": "local function ${1:}(${2:})\n\t${3:}\nend",
            }, {
                "name": "repeat .. until",
                "content": "repeat\n\t${1:}\nuntil${3:}",
            }, {
                "name": "then .. end",
                "content": "then\n\t${1:}\nend",
            }, {
                "name": "while .. do",
                "content": "while ${1:true} do\n\t${3:}\nend",
            }, {
                "name": "GetService",
                "content": "GetService(\"${1:}\")",
            }, {
                "name": "Connect",
                "content": "Connect(function(${1:})\n\t${2:}\nend)",
            },
        ]
        
		var combinedFunctions = functionsWithArgs.concat(functionsWithoutArgs);
		
        // Inject Autocomplete Options and Custom Snippets
		setTimeout(function () {
			var highlightRules = editor.session.$mode.$highlightRules;

			function FormatRules(highlight) {
				var defaultToken = "identifier";

				var map = {
					"keyword": keywords,
					//"support.function": combinedFunctions,
					"constant.library": libraries,
					"constant.language": constants,
					"variable.language": "self"
				};

				var wordType = Object.create(null);
				highlightRules.$keywordList = [];
				Object.keys(map).forEach(function (className) {
					var a = map[className];
					
					//if (className != "support.function") {
					var list = a.split("|");
					for (var i = list.length; i--; ) {
						var word = list[i];
						highlightRules.$keywordList.push(word);
						wordType[word] = className;
					}
					//}
				}, highlightRules);
				map = null;

				if (highlight) {
					wordType["local"] = "constant.language";
					wordType["or"] = "constant.language";
					wordType["and"] = "constant.language";
					wordType["not"] = "constant.language";
				}

				return function (value) { return wordType[value] || defaultToken; };
			}

			highlightRules.$rules.start[7]["token"] = FormatRules();
			highlightRules.$rules.start[7]["onMatch"] = FormatRules(true);
		
			ace.require("ace/snippets").snippetManager.snippetMap.lua = snippets;

			// Custom Completer for Snippets
			var snippetCompleter = {
				getCompletions: function (editor, session, pos, prefix, callback) {
					var snippetManager = ace.require("ace/snippets").snippetManager;
					var snippetMap = snippetManager.snippetMap.lua || [];
					
					var completions = snippetMap.map(function (snippet) {
						return {
							caption: snippet.name || snippet.content,
							snippet: snippet.content,
							meta: "snippet",
							score: 1000 // High score for snippets to appear above keywords
						};
					});

					callback(null, completions);
				}
			};

			// Custom Completer for Keywords
			var keywordCompleter = {
				getCompletions: function (editor, session, pos, prefix, callback) {
					var keywords = highlightRules.$keywordList || [];
					
					var completions = keywords.map(function (word) {
						return {
							caption: word,
							value: word,
							meta: "keyword",
							score: 500 // Lower score for keywords to appear below snippets
						};
					});

					callback(null, completions);
				}
			};
			var functionCompleter = {
				getCompletions: function(editor, session, pos, prefix, callback) {
					var completions = combinedFunctions.map(function(func) {
						return {
							caption: func,
							value: func, // Directly insert the function with parentheses
							meta: "function",
							score: 1500,
							completer: {
								onInsert: function() {
									var currentEditor = editor; // Capture editor reference

									// Insert the function name with parentheses
									currentEditor.insert("()");

									if (functionsWithArgs.includes(func)) {
										var cursorPosition = currentEditor.getCursorPosition();
										currentEditor.moveCursorTo(cursorPosition.row, cursorPosition.column - 1);
									}
								},
							},
						};
					});

					callback(null, completions);
				},
			};


			// Register the custom completers
			editor.completers = [snippetCompleter, keywordCompleter, functionCompleter];

		}, 100);

        // Add Images to Suggestion Box
        function getUrl(image) {
            var iconUrl = "https://raw.githubusercontent.com/microsoft/vscode-icons/master/icons/dark/";
            return "url(\"" + iconUrl + image + ".svg\")";
        }
        
        function addIcon(event) {
            var element = event.srcElement;
            
            if (element.classList.contains("ace_line")) {
                var lineType = element.querySelector(".ace_completion-meta");
            }
            
            else if (element.classList.contains("ace_completion-meta")) {
                var lineType = element;
            }
            
            else return;
            
            if (lineType.innerText === "") return;
            
            if (lineType.innerText == "local") {
                lineType.style.backgroundImage = getUrl("symbol-variable");
            }
            
            else if (lineType.innerText == "snippet") {
                lineType.style.backgroundImage = getUrl("symbol-snippet");
            }

            else if (lineType.innerText == "keyword") {
                lineType.innerText = "";

                var fullText = "";
                var children = Array.from(lineType.parentElement.children);

                children.forEach(function(child) {
                    fullText += child.innerText;
                });

                if (keywords.includes(fullText)) {
                    lineType.style.backgroundImage = getUrl("symbol-keyword");
                }

                else if (libraries.includes(fullText)) {
                    lineType.style.backgroundImage = getUrl("symbol-namespace");
                }

                else if (constants.includes(fullText)) {
                    lineType.style.backgroundImage = getUrl("symbol-constant");
                }

                else if (classes.includes(fullText)) {
                    lineType.style.backgroundImage = getUrl("symbol-class");
                }
            } else if (lineType.innerText == "function") {
				lineType.style.backgroundImage = getUrl("symbol-method");
			}
            
            lineType.innerText = "";
        }
        
        document.addEventListener("DOMNodeInserted", function getEditor(event) {
		
            var element = event.srcElement;
            var editor = document.querySelector("div.ace_editor");
            
            if (element != editor) return;
            
            var textArea = editor.querySelector(".ace_text-layer");
            textArea.addEventListener("DOMNodeInserted", addIcon, false);
            
            document.removeEventListener("DOMNodeInserted", getEditor);
        });
        
        // Preloading Images
        function cacheImage(url) {
            document.body.style.backgroundImage = getUrl(url);
        }

        cacheImage("symbol-variable");
        cacheImage("symbol-snippet");
        cacheImage("symbol-keyword");
        cacheImage("symbol-namespace");
        cacheImage("symbol-constant");
        cacheImage("symbol-class");
        cacheImage("symbol-method");
        
        document.body.style.backgroundImage = "none";
		
		SetText('print("Hello World")')
    </script>

    <!-- VS Synapse Custom Theme -->
    <style>
        /* General Editor */
        .ace_editor {
            background-color: #00000000 !important;
            color: #c6c6c6 !important;
        }
        
        pre .ace_scroller {
            left: 40px !important;
            box-shadow: none !important;
        }
        
        .ace_gutter {
            width: 40px !important;
            background-color: #00000000 !important;
            color: #c6c6c6 !important;
        }
        
        .ace_gutter-layer {
            width: 40px !important;
        }

        
        /* Better Lines */
        .ace_active-line {
            margin-left: 4px !important;
            border: 2px solid #00000000 !important;
            border-left: none !important;
            border-right: none !important;
            height: 13px !important;
            background-color: #00000000 !important;
        }
        
		#aabd {
			z-index: 10;
			position: absolute;
			top: 0;
			opacity: 0;
			bottom: 0;
			left: 0;
			right: 0;
			user-select: none;
			pointer-events: none;
		}
		
		#balzak{
			display: inline-block;
			width: max-content;
			height: 40px;
			font-family: Monaco, Menlo, "Ubuntu Mono", Consolas, source-code-pro, monospace;
			position: absolute;
			color: white;
			z-index: 10;
			top: 0;
			opacity: 0;
			bottom: 0;
			left: 0px;
			right: 0;
			user-select: none;
			pointer-events: none;
			font-size: 16px;
		}
		#vert{
			opacity: 0.3;
			z-index: 20;
			position: absolute;
			top: 0;
			left: 0;
			background-color: white;
			height: 0px;
			width: 2px;
			user-select: none;
			pointer-events: none;
		}
		#hor{
			opacity: 0.3;
			z-index: 20;
			position: absolute;
			top: 0;
			left: 0;
			background-color: white;
			width: 0px;
			height: 2px;
			user-select: none;
			pointer-events: none;
		}
	
        .ace_gutter-active-line {
            background-color: #00000000 !important;
            color: #c6c6c6 !important;
        }
		
        /* Better Errors */
        .ace_error {
            background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMBAMAAACkW0HUAAAAAXNSR0IArs4c6QAAAB5QTFRFAAAA7yAg7yAo9yAo6xsl6x4l7hsi7hsl7h4i7h4lXT9DbgAAAAp0Uk5TACAgIExMTExMTKnnIM0AAABSSURBVAgdBcGxCYAwEIbRD1KInSPYOYMThEwg6Q/Sqhz5yRZWp+P6HqSvrkB7i8MkyU92V24XQzFaUE2yQfWQd4b1LLGZst/MLbIeUBQDUj8WfjCfGVDnYUGeAAAAAElFTkSuQmCC") !important;
            background-position: 5px center !important;
            background-size: 10px 10px !important;
            background-repeat: no-repeat !important;
			padding-right: 5px !important;
			left: -5px !important;
        }

        
        /* Better Scrollbar */
        ::-webkit-scrollbar {
            width: 10px !important;
            height: 10px !important;
        }
        
        ::-webkit-scrollbar-thumb {
            background-color: #424242 !important;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background-color: #4F4F4F !important;
        }
        
		.ace_gutter-cell {
			padding-left: 0px !important;
		}


        /* Autocompletion */
        .ace_autocomplete {
            margin-left: 13px !important;
            box-shadow: none !important;
            border: 1px solid #454545 !important;
            background-color: #252526 !important;
            font-size: 14px !important;
            color: #C4C4C4 !important;
        }
        
        .ace_autocomplete .ace_active-line {
            z-index: 10 !important;
            margin-left: 0 !important;
            border: none !important;
            height: 21px !important;
            background-color: #094771 !important;
        }
        
        .ace_autocomplete .ace_line-hover {
            border: none !important;
            height: 21px !important;
            background-color: #2A2D2E !important;
        }
        
        .ace_completion-meta {
            float: left !important;
            opacity: 1 !important;
            margin: 0px !important;
            margin-right: 4px !important;
            width: 20px !important;
            height: 20px !important;
            background-size: 16px !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
        }
        
        .ace_completion-highlight {
            color: #C4C4C4 !important;
        }
        
        .ace_selected {
            color: #FFFFFF !important;
        }
        
        .ace_selected .ace_completion-highlight {
            color: #FFFFFF !important;
        }
        
        .ace_selected .ace_completion-meta {
            filter: brightness(25) !important;
        }

        /* Better Snippets */
        .ace_snippet-marker {
            display: none !important;
        }

        
        /* Syntax Highlighting */
        .ace_keyword {
            color: #C586C0 !important;
        }

        .ace_constant {
            color: #569CD6 !important;
        }

        .ace_identifier {
            color: #9CDCFE !important;
        }

        .ace_function {
            color: #DCDCAA !important;
        }

        .ace_numeric {
            color: #B5CEA8 !important;
        }

        .ace_comment {
            color: #6A9955 !important;
        }

        .ace_operator {
            color: #D4D4D4 !important;
        }

        .ace_string {
            color: #CE9178 !important;
        }
    </style>
</body>
</html>
